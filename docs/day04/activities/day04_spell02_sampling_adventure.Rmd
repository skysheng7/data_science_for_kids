---
title: "üîÆ Day 4 - Spell 2: The Great Creature Sampling Adventure"
output: html_document
---

```{r setup-locale, include=FALSE}
Sys.setlocale("LC_CTYPE", "en_US.UTF-8")
```

## üí° What is Sampling?
Imagine you want to know how many dragons live in the entire Enchanted Forest, but you can't count them all! So you explore small areas, count the dragons there, and use that to guess about the whole forest. That's sampling!

**üå≤ Population** = All the creatures in the entire Enchanted Forest (everything we want to know about)  
**üîç Sample** = The creatures we find in one small area we explore (the small group we actually study)  
**üìä Statistic** = Something we calculate using our sample (like "30% of creatures in our sample are dragons")  
**üéØ Inference** = Using our sample to make a conclusion about the whole population

```{r setup}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(ggplot2)
library(dplyr)
library(infer)  # For rep_sample_n function
set.seed(123)  # For reproducible results
```

## üêâ Our Magical Population: The Enchanted Forest
Let's create our population of 100000 magical creatures where exactly 30% are dragons!

```{r create-population}
# Create our population of 100000 creatures
# 30000 dragons (30%) and 70000 other creatures (70%)
magical_creatures <- tibble(
  creature_id = 1:100000,
  creature_type = factor(c(rep("dragon", 30000), rep("other", 70000)))
)

# Let's verify our true population proportion
true_dragon_proportion <- sum(magical_creatures$creature_type == "dragon") / nrow(magical_creatures)
print(paste("üéØ True proportion of dragons in population:", true_dragon_proportion))

# Visualize our population
population_summary <- magical_creatures %>%
  count(creature_type) %>%
  mutate(proportion = n / sum(n))

ggplot(population_summary, aes(x = creature_type, y = proportion, fill = creature_type)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = c("dragon" = "orange", "other" = "gray")) +
  labs(title = "üå≤ True Population: Enchanted Forest Creatures",
       x = "Creature Type", 
       y = "Proportion",
       subtitle = "Population Size: 100000 creatures, 30% dragons") +
  theme_minimal() +
  theme(text = element_text(size = 16),
        plot.title = element_text(size = 20),
        axis.title = element_text(size = 18),
        axis.text = element_text(size = 19),
        legend.position = "none")
```

## üé£ Taking Our First Sample (Size 40)
Let's explore one area of the forest and see what creatures we find!

```{r first-sample}
# Take one random sample of 40 creatures
creature_sample_1 <- rep_sample_n(magical_creatures, size = 40)
creature_sample_1

# What's the proportion of dragons in our sample?
dragon_estimate_1 <- creature_sample_1 %>%
  count(creature_type) %>%
  mutate(proportion = n / sum(n))

print("üîç Our first sample results:")
dragon_estimate_1

ggplot(dragon_estimate_1, aes(x = creature_type, y = proportion, fill = creature_type)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = c("dragon" = "orange", "other" = "gray")) +
  labs(title = "üå≤ First Sample: Enchanted Forest Creatures",
       x = "Creature Type", 
       y = "Proportion",
       subtitle = "Sample Size: 40 creatures") +
  theme_minimal() +
  theme(text = element_text(size = 16),
        plot.title = element_text(size = 20),
        axis.title = element_text(size = 18),
        axis.text = element_text(size = 19),
        legend.position = "none")
```

## üé£ Taking Another Sample
What happens if we explore a different area of the forest? Will we get the same result?

```{r second-sample}
# Take another random sample of 40 creatures
dragon_estimate_2 <- rep_sample_n(magical_creatures, size = 40) %>%
  count(creature_type) %>%
  mutate(proportion = n / sum(n))

print("üîç Our second sample results:")
dragon_estimate_2

ggplot(dragon_estimate_2, aes(x = creature_type, y = proportion, fill = creature_type)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = c("dragon" = "orange", "other" = "gray")) +
  labs(title = "üå≤ Second Sample: Enchanted Forest Creatures",
       x = "Creature Type", 
       y = "Proportion",
       subtitle = "Sample Size: 40 creatures") +
  theme_minimal() +
  theme(text = element_text(size = 16),
        plot.title = element_text(size = 20),
        axis.title = element_text(size = 18),
        axis.text = element_text(size = 19),
        legend.position = "none")

```

## üé£ And One More Sample!
Let's try once more to see the variability between samples:

```{r third-sample}
# Take a third random sample of 40 creatures
dragon_estimate_3 <- rep_sample_n(magical_creatures, size = 40) %>%
    count(creature_type) %>%
  mutate(proportion = n / sum(n))

print("üîç Our third sample results:")
dragon_estimate_3

ggplot(dragon_estimate_3, aes(x = creature_type, y = proportion, fill = creature_type)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = c("dragon" = "orange", "other" = "gray")) +
  labs(title = "üå≤ Third Sample: Enchanted Forest Creatures",
       x = "Creature Type", 
       y = "Proportion",
       subtitle = "Sample Size: 40 creatures") +
  theme_minimal() +
  theme(text = element_text(size = 16),
        plot.title = element_text(size = 20),
        axis.title = element_text(size = 18),
        axis.text = element_text(size = 19),
        legend.position = "none")
```

## üìä The Sampling Distribution: Taking LOTS of Samples!
What if we explore 1000 different areas of the forest? Let's see what the distribution of our estimates looks like!

```{r sampling-distribution}
# Take 1000 samples of size 40 and calculate proportions for each
sampling_results <- rep_sample_n(magical_creatures, size = 40, reps = 300) %>%
  group_by(replicate) %>%
  summarize(proportion = sum(creature_type == "dragon") / 40)

mean_of_sampling <- mean(sampling_results$proportion)
sd_of_sampling <- sd(sampling_results$proportion)

# Plot the sampling distribution
ggplot(sampling_results, aes(x = proportion)) +
  geom_histogram(binwidth = 0.05, fill = "#91d4eb", color = "white", alpha = 0.7) +
  geom_vline(xintercept = true_dragon_proportion, color = "#9090ea", linetype = "solid", linewidth = 1) +
  geom_vline(xintercept = mean_of_sampling, color = "#e1b086", linetype = "dashed", linewidth = 1) +
  labs(title = "üé≤ Sampling Distribution: 1000 Samples of Size 40",
       x = "Sample Proportion of Dragons", 
       y = "Count",
       subtitle = "Purple solid line shows true population proportion (0.30), Orange dashed line shows mean of sampling distribution") +
  theme_minimal() +
  theme(text = element_text(size = 12),
        plot.title = element_text(size = 16),
        axis.title = element_text(size = 15),
        axis.text = element_text(size = 12),
        legend.position = "none")


# Calculate statistics about our sampling distribution
print(paste("üìä Average of all sample proportions:", round(mean_of_sampling, 3)))
print(paste("üìè Spread (standard deviation) of sample proportions:", round(sd_of_sampling, 3)))
print(paste("üéØ True population proportion:", true_dragon_proportion))
```

## üìä The Magic of Sample Size: What If We Change Sample Size?
Let's see what happens when we use different sample sizes!

```{r sample-size-comparison}
# Compare different sample sizes: 20, 40, and 200
sample_sizes <- c(20, 40, 200)
all_results <- tibble()

for (size in sample_sizes) {
  results <- rep_sample_n(magical_creatures, size = size, reps = 300) %>%
    group_by(replicate) %>%
    summarize(proportion = sum(creature_type == "dragon") / size,
              sample_size = paste("Size", size))
  
  all_results <- bind_rows(all_results, results)
}
  
  # Order facets small ‚Üí large and compute mean per sample size for dashed lines
  all_results <- all_results %>%
    mutate(sample_size = factor(sample_size, levels = c("Size 20", "Size 40", "Size 200")))

  sample_means <- all_results %>%
    group_by(sample_size) %>%
    summarize(mean_proportion = mean(proportion), .groups = "drop")

  # Create comparison plot (3x1 facets, styled like the chart above)
  ggplot(all_results, aes(x = proportion, fill = sample_size)) +
    geom_histogram(binwidth = 0.05, color = "white", alpha = 0.7) +
    geom_vline(xintercept = true_dragon_proportion, color = "#9090ea", linetype = "solid", linewidth = 1) +
    geom_vline(data = sample_means, aes(xintercept = mean_proportion), color = "#e1b086", linetype = "dashed", linewidth = 1) +
    facet_wrap(~sample_size, ncol = 1) +
    scale_fill_manual(values = c(
      "Size 20" = "#cfe8ff",  # light blue
      "Size 40" = "#91d4eb",  # medium blue (matches above)
      "Size 200" = "#4da3d9"  # darker blue
    )) +
    labs(title = "üåü The Magic of Sample Size: All Distributions Compared",
         x = "Sample Proportion of Dragons", 
         y = "Count",
         subtitle = "Purple line = true proportion (0.30). Orange dashed line = mean of each sampling distribution.") +
    theme_minimal() +
    theme(
      legend.position = "none",
      text = element_text(size = 12),
      plot.title = element_text(size = 16),
      axis.title = element_text(size = 15),
      axis.text = element_text(size = 12)
    )

# Calculate summary statistics
summary_stats <- all_results %>%
  group_by(sample_size) %>%
  summarize(
    Average_Proportion = mean(proportion),
    Spread_SD = sd(proportion),
    .groups = "drop"
  ) %>%
  mutate(True_Proportion = true_dragon_proportion,
         Difference = abs(Average_Proportion - True_Proportion))

print("üèÜ Summary of All Experiments:")
print(summary_stats)
```


## üéØ Key Magical Discoveries!

**üîç Discovery 1: The Law of Large Numbers**
- All sample sizes give us averages close to the true population proportion (0.30)
- Larger samples don't change the average, but they make it more reliable!

**üìè Discovery 2: Sample Size and Spread**
- **Small samples (10):** High variability - samples can be quite different from each other
- **Medium samples (50):** Medium variability - samples are more consistent
- **Large samples (100):** Low variability - samples are very consistent and close to truth

**üé™ Discovery 3: The Sampling Distribution Shape**
- All sampling distributions are roughly bell-shaped (normal)
- They all center around the true population value
- Larger sample sizes create narrower, more precise distributions

## üí° Real-World Magic Applications

**üó≥Ô∏è Political Polls:** When pollsters survey 1000 people instead of 100, their predictions are much more accurate!

**üéÆ Game Testing:** Game companies test with large groups to get reliable feedback about what players really think.

**üçï Restaurant Reviews:** A restaurant with 500 reviews gives you a better idea of quality than one with 5 reviews!

**‚öïÔ∏è Medical Research:** Doctors test medicines on large groups to be confident about the results.
